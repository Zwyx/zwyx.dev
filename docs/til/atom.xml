<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://zwyx.dev/til</id>
    <title>Zwyx's TILs</title>
    <updated>2025-08-01T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://zwyx.dev/til"/>
    <subtitle>Today I Learnt about dev stuff</subtitle>
    <icon>https://zwyx.dev/img/Zwyx-220x220-rounded-favicon.ico</icon>
    <rights>Copyright © 2025 Zwyx.</rights>
    <entry>
        <title type="html"><![CDATA[Custom clone function in JavaScript]]></title>
        <id>https://zwyx.dev/til/2025/08/01/Custom clone function in JavaScript</id>
        <link href="https://zwyx.dev/til/2025/08/01/Custom clone function in JavaScript"/>
        <updated>2025-08-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[We can easily clone an object in JavaScript using the structuredClone method, Ramda's clone, or Lodash's cloneDeep.]]></summary>
        <content type="html"><![CDATA[<p>We can easily clone an object in JavaScript using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/structuredClone" target="_blank" rel="noopener noreferrer"><code>structuredClone</code></a> method, Ramda's <a href="https://ramdajs.com/docs/#clone" target="_blank" rel="noopener noreferrer"><code>clone</code></a>, or Lodash's <a href="https://lodash.com/docs/4.17.15#cloneDeep" target="_blank" rel="noopener noreferrer"><code>cloneDeep</code></a>.</p>
<p>However, writing our own cloning function can lead to much better performances.</p>
<p>For the Codewars kata <a href="https://www.codewars.com/kata/688b957a12698cb53d5959fe" target="_blank" rel="noopener noreferrer">Win at Skyjo</a>, the function <a href="https://github.com/Zwyx/codewars-skyjo-resources/blob/df3cdcc47cf16b8904bd5f3fae015f25bc298cb0/src/utils.ts#L59" target="_blank" rel="noopener noreferrer"><code>getPlayersColumnsClone</code></a> deep clones an array of five arrays, themselves arrays of four arrays, themselves arrays of three arrays of simple objects with four properties.</p>
<p>Here's how this function performs 100,000 cloning operations compare to other methods:</p>
<!-- -->
<!-- -->
<code>getPlayersColumnsClone</code> <!-- -->0.06<!-- --> s<div style="margin-top:2px;margin-bottom:12px;display:flex;align-items:center"><span style="display:inline-block;width:0.6960556844547564%;height:8px;background-color:var(--ifm-link-color);border-radius:5px"></span></div><code>structuredClone</code> <!-- -->2.54<!-- --> s<div style="margin-top:2px;margin-bottom:12px;display:flex;align-items:center"><span style="display:inline-block;width:29.46635730858469%;height:8px;background-color:var(--ifm-link-color);border-radius:5px"></span></div><code>Lodash.cloneDeep</code> <!-- -->4.68<!-- --> s<div style="margin-top:2px;margin-bottom:12px;display:flex;align-items:center"><span style="display:inline-block;width:54.292343387471%;height:8px;background-color:var(--ifm-link-color);border-radius:5px"></span></div><code>Ramda.clone</code> <!-- -->8.62<!-- --> s<div style="margin-top:2px;margin-bottom:12px;display:flex;align-items:center"><span style="display:inline-block;width:100%;height:8px;background-color:var(--ifm-link-color);border-radius:5px"></span></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Benchmark implementation</summary><div><div class="collapsibleContent_i85q"><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Lodash </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"lodash"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> Ramda </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ramda"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUMBER_OF_PLAYERS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUMBER_OF_COLUMNS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUMBER_OF_ROWS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> playersColumns </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> length</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUMBER_OF_PLAYERS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token builtin">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> length</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUMBER_OF_COLUMNS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token builtin">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> length</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUMBER_OF_ROWS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			card</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			visible</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> cloneFunctions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Ramda</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clone</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Lodash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cloneDeep</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	structuredClone</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	getPlayersColumnsClone</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> cloneFunction </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> cloneFunctions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Cloning with '</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">cloneFunction</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">'...</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> startTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> performance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100_000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function" style="color:#d73a49">cloneFunction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">playersColumns</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> duration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">performance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Took </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">duration</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c"> s</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div></div></div></details>]]></content>
        <category label="javascript" term="javascript"/>
        <category label="clone" term="clone"/>
        <category label="bun" term="bun"/>
        <category label="node" term="node"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[DDC/CI]]></title>
        <id>https://zwyx.dev/til/2025/02/05/ddc-ci</id>
        <link href="https://zwyx.dev/til/2025/02/05/ddc-ci"/>
        <updated>2025-02-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[The DDC/CI standard (introduced in 1998!) allows a computer to send commands to external monitors.]]></summary>
        <content type="html"><![CDATA[<p>The <a href="https://en.wikipedia.org/wiki/Display_Data_Channel#DDC/CI" target="_blank" rel="noopener noreferrer">DDC/CI</a> standard (introduced in 1998!) allows a computer to send commands to external monitors.</p>
<p>For instance, we can programmatically set the brightness of all our monitors:</p>
<ul>
<li>install <a href="https://github.com/rockowitz/ddcutil" target="_blank" rel="noopener noreferrer">ddcutil</a>:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> ddcutil</span><br></span></code></pre></div></div>
<ul>
<li>create a shortcut associated with a script to switch between bright and dim:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">cat</span><span class="token string variable" style="color:#36acaa"> /sys/class/backlight/intel_backlight/brightness</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"960"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic"># Set laptop monitor's brightness</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">57984</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> /sys/class/backlight/intel_backlight/brightness</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic"># Set external monitors' brightness</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> ddcutil setvcp 0x10 </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">960</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> /sys/class/backlight/intel_backlight/brightness</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> ddcutil setvcp 0x10 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre></div></div>
<p><code>0x10</code> is the code for <code>brightness</code>. Run <code>sudo ddcutil detect</code> to list the monitors <code>ddcutil</code> can work with, and <code>sudo ddcutil getvcp all</code> to list the features available.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Because <code>sudo</code> is required, the shortcut's command needs to use <code>pkexec</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pkexec /path/to/switch-brightness.sh</span><br></span></code></pre></div></div></div></div>
<p>And by the way, here's another script, to switch between light and dark themes:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">gsettings get org.gnome.desktop.interface gtk-theme</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"'Yaru'"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	gsettings </span><span class="token builtin class-name">set</span><span class="token plain"> org.gnome.desktop.interface color-scheme </span><span class="token string" style="color:#e3116c">"prefer-dark"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	gsettings </span><span class="token builtin class-name">set</span><span class="token plain"> org.gnome.desktop.interface gtk-theme </span><span class="token string" style="color:#e3116c">"Yaru-dark"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	gsettings </span><span class="token builtin class-name">set</span><span class="token plain"> org.gnome.desktop.interface color-scheme </span><span class="token string" style="color:#e3116c">"prefer-light"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	gsettings </span><span class="token builtin class-name">set</span><span class="token plain"> org.gnome.desktop.interface gtk-theme </span><span class="token string" style="color:#e3116c">"Yaru"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre></div></div>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Annotated and lightweight tags]]></title>
        <id>https://zwyx.dev/til/2025/01/24/Annotated and lightweight tags</id>
        <link href="https://zwyx.dev/til/2025/01/24/Annotated and lightweight tags"/>
        <updated>2025-01-24T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Git has two kinds of tags: annotated and lightweight.]]></summary>
        <content type="html"><![CDATA[<p>Git has <a href="https://git-scm.com/book/en/v2/Git-Basics-Tagging" target="_blank" rel="noopener noreferrer">two kinds of tags</a>: <em>annotated</em> and <em>lightweight</em>.</p>
<ul>
<li>An annotated tag is stored as an object. It contains the name of the user who created it (the <em>tagger</em>), it can be signed, etc.</li>
<li>A lightweight tag is like a branch that doesn't change.</li>
</ul>
<p>Although using one kind or the other doesn't change anything most of the times, there are cases where knowing the difference is useful. GitHub Actions for instance, has a different behaviour for the two: when we push a <strong>lightweight</strong> tag which is on the latest commit of branch <code>main</code>, <code>github.event.base_ref</code> contains <code>refs/heads/main</code>. This allows us to run a workflow on new tags only created on the main branch:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"v[0-9]+.[0-9]+.[0-9]+"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build-website</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github.event.base_ref == 'refs/heads/main'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre></div></div>
<p>However, <strong>this doesn't work if the tag is annotated</strong>.</p>
<p>Commands like <code>npm version</code> create annotated tags, so we can just add a <code>postversion</code> script in <code>package.json</code> to convert the newly created annotated tag to a lightweight one:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">tag</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">git</span><span class="token variable" style="color:#36acaa"> tag --points-at HEAD</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> tag </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$tag</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> tag </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$tag</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> HEAD</span><br></span></code></pre></div></div>
<p>See the whole files at <a href="https://github.com/Zwyx/library-of-babel" target="_blank" rel="noopener noreferrer">github.com/Zwyx/library-of-babel</a>.</p>]]></content>
        <category label="git" term="git"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[interactive-widget]]></title>
        <id>https://zwyx.dev/til/2024/03/27/interactive-widget</id>
        <link href="https://zwyx.dev/til/2024/03/27/interactive-widget"/>
        <updated>2024-03-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[The viewport meta tag option interactive-widget allows us to choose what the browser should do with our page when some overlay elements — such as a phone on-screen keyboard — appear:]]></summary>
        <content type="html"><![CDATA[<p>The <code>viewport</code> meta tag option <code>interactive-widget</code> allows us to choose what the browser should do with our page when some overlay elements — such as a phone on-screen keyboard — appear:</p>
<!-- -->
<div class="imageWrapper_u91s withLegend_q8O0"><div class="frame_zT4L"><img class="image_Y_cJ" src="https://zwyx.dev/assets/images/2024-03-27-interactive-widget-visual-comparison-all-ff711d1c9df866930cdc6b23602ac624.webp" alt="interactive-widget options comparison"></div><div class="legend_xj0V"><code>interactive-widget</code> options comparison. The difference between<!-- --> <code>resizes-visual</code> and <code>overlays-content</code> is that<!-- --> <code>resizes-visual</code> allows the user to scroll the page up to see the sticky element at the bottom, whereas <code>overlays-content</code> <!-- -->doesn't.</div></div>
<p>Chrome's default behaviour on Android, before version 108, was <code>resizes-content</code> — it is now <code>resizes-visual</code>.</p>
<p>For example, the <a href="https://babel.zwyx.dev/" target="_blank" rel="noopener noreferrer">Library of Babel</a>'s <code>viewport</code> meta tag is now:</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">	</span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">viewport</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">	</span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">width=device-width, initial-scale=1.0, interactive-widget=resizes-content</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f"></span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre></div></div>
<p>This allows the sticky pagination component to be always visible when the on-screen keyboard is open:</p>
<div style="text-align:center"><div class="imageWrapper_u91s withLegend_q8O0"><div class="frame_zT4L"><img class="image_Y_cJ" src="https://zwyx.dev/assets/images/2024-03-27-interactive-widget-babel-2b3e7ed27a3f3bce5ac7359e6cff7ecb.webp" alt="Example on the Library of Babel" width="350"></div><div class="legend_xj0V">The keyboard is<!-- --> <a href="https://github.com/dessalines/thumb-key" target="_blank" rel="noopener noreferrer">Thumb-Key</a>.</div></div></div>
<p>Without <code>interactive-widget</code>, scrolling down while the keyboard was open made the sticky pagination component to disappear.</p>
<p>Read more at <a href="https://developer.chrome.com/blog/viewport-resize-behavior" target="_blank" rel="noopener noreferrer">developer.chrome.com/blog/viewport-resize-behavior</a> (which is the source of the comparison image above).</p>]]></content>
        <category label="viewport" term="viewport"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Fast integer-to-string conversion]]></title>
        <id>https://zwyx.dev/til/2024/02/01/Fast integer-to-string conversion</id>
        <link href="https://zwyx.dev/til/2024/02/01/Fast integer-to-string conversion"/>
        <updated>2024-02-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[This content kept growing, so it has been moved into a blog post.]]></summary>
        <content type="html"><![CDATA[<p>This content kept growing, so it has been moved into a <a href="https://zwyx.dev/blog/base-conversions-with-big-numbers-in-javascript">blog post</a>.</p>]]></content>
        <category label="javascript" term="javascript"/>
        <category label="v8" term="v8"/>
        <category label="string" term="string"/>
        <category label="integer" term="integer"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Fast string-to-integer conversion]]></title>
        <id>https://zwyx.dev/til/2023/12/31/Fast string-to-integer conversion</id>
        <link href="https://zwyx.dev/til/2023/12/31/Fast string-to-integer conversion"/>
        <updated>2023-12-31T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[This content kept growing, so it has been moved into a blog post.]]></summary>
        <content type="html"><![CDATA[<p>This content kept growing, so it has been moved into a <a href="https://zwyx.dev/blog/base-conversions-with-big-numbers-in-javascript">blog post</a>.</p>]]></content>
        <category label="javascript" term="javascript"/>
        <category label="v8" term="v8"/>
        <category label="string" term="string"/>
        <category label="integer" term="integer"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[GPU rasterization in Chrome]]></title>
        <id>https://zwyx.dev/til/2023/06/30/GPU rasterization in Chrome</id>
        <link href="https://zwyx.dev/til/2023/06/30/GPU rasterization in Chrome"/>
        <updated>2023-06-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In case of weird text rendering issues in Chrome looking like this:]]></summary>
        <content type="html"><![CDATA[<p>In case of weird text rendering issues in Chrome looking like this:</p>
<p><img decoding="async" loading="lazy" alt="Text issue" src="data:image/webp;base64,UklGRowHAABXRUJQVlA4IIAHAACQKACdASpqAC8APjEUh0KiIQvOzowQAYJQBmYuhzL1l7AcRS216ANtf+IHsL/Yr1uPQB5rvpN+pR/Ov8P7AH7Aeml7H/91/5XpmatJ0A7Jv6X+Qnm33ku2HrN+Om+s/sH4ze4f8S+q31b8lv6j+6HElfs3qBem/6t+WfBM0U/tfqBepXzT/G/mB5H38B+QHuZ9Kf8B6Cv9m/Kr+pfCv9J/zPiDdgf1X3AP4n/Lf8R/c/2o/vX0dftH+5/t35Heyb8l/rf+v/xXwB/yP+ef53+5/ur/nv//9O/sI/bf2Q/1zY21m+dEgSFn10Zai6oDQ3pL0WpskwzW6lYRrmCf/LmPWky9DUn97hX/fTkBtS3g+/6U1wkDqF/BU13OX3//BLxoRiQbOMmQKko3T+FNFQC+pmwF/reoziciFm6nm/SdUxKE5SD13ld9cIJyeFwA/v/7OATefdES2mbQXP1+sqyYnsJMeQjD525Odpl5FmTM5kKqo73jxr8keTzVSW0Qr+NofLGR7MFhpSPLTmU0QqN1ZvOeA1NT5cBtEpgVhMySOfgZbtGw15WOY7DRfOuvjBThi7i3HPyLG+lhjsXlH/vWNmf97KoeWdQOeO2dbdUUj8V1UQvwgKE5Ks2GxVx0Ux6mOHdudbOKRhFmLlLFEucdysqA77LRp4ba155FZEypPzkcZsLhnrp4INu/9TCeFQXnqYPG0bK14J8TZqFWDoIZFSeiBvFAbQwi25eM05iPwyorW2hJz7H+Ffhlcz6H8sIiRv8CmeJ+EeQj+fcNSwr8Yj2cTSP2wktflr1V1rZaQ/Djs0dY/cl/RAe3QcY9D1v7l3zONnsRbTvOgI6G2okF9hrXOEddn/uM8PqyQyjpNiiQ6g8Za81ZAfmsim4bUBFljh+e/i8p/XPdqA8N0GxSqfqxanESpLxFTwEF8cEMRrFet6L6k3al0plcpAnZzHZKss+vrtRd5UENRpn5zD5HOGRVcuKtIniWfwj7fwoC3Oe+kuNwzksGYGgs+/5VgQlkYQdDBfSSVniItynHSxNs1PYLGe1csB5j7WytoL7OcN2jZ889iOMNOgOhV/G2NGL7E/guMwdy92d6Oz96/l1dlvYst93HiHus/u6wU0WjGAb+NQXrm+vo6YxU0S1DXnWImk+/kXOyS6W9HNDN4wz4RpOGwNYNZ7MnFqZZaQHfkNo+qMFiqGM1H40CQyPGTn65F2xo6dd4hOZZf+dqfd8bwnbkbsUws8zed8axH18mvjtsXsCluBMv8TTxxkD3yIkNkq4CSyhFCGvqjaZtlII/BspjiotRkfzRbKPEFnLd/HXKhD8FCgft9BNWj+iblIaYubtUSqSXF4/Rp1NlTzpiV80v1UzoDSZNjhomp9g/BV34RwmqRgZ1ZYIN/YMShkr4U9ocTZduxMj1co3XvjLrTLHpg85gJDwukrkN3sNS3R5McaGMrD/fuJ1WQZfgH+IyMV4GQLbQ8gUoDMMPk4EjLmeHXFGkN95EvYQWP3sqZqLgMcIft2Drw4ozYV+SSbDQbp22EXC6wKTcmtEl1wohLCiSwA3UnyUnU6OzqFZ83LIMf+M03kDHyc4KM0ixcWt8zy+tM5nOPhLGILK9yX77v8QSLwJ0xL5eI/TzH0oJ0soYnywHX/afXAEzaTqiQzL24v5I1DSgsFBEUdyuTyyrXBtC/6PEkj0DPdpYNNsfIhu3u7h4WfjDexenIM82n4Qx4XwdmTcXPH73jaAYuQg2e03WF6ozmSAlRVvCabnl8FO7s31xFjWUmFl1FCTefMmflxUZFl3LeQu9s+nbeGnOE41kfT7qBD//zJA9wieBTXK3LCsK0klH1aQmelxLux1uvgO4Lrl/D2rNtt0h+lKWtSinvzP20XRke5Ynwy8DkyHvQrJOe146pCD7bMvxGHW392H+zt74mD9K3X7NmorHQyYeVpG19033N9fYStZvPR+hV/92U3JrUSPI5KtrdEyCsP5/T6nS1qUReIVFQmiFds/LbutHVph6SQwpAo5zp9HuMtN6ZLMd3uVZpMKnvvhnh8Bz1u8occ6Fff+rP9egGNt/5YaTL21LiTmxAeNfNHVdDRRH0XR9hVa7fmPl/qQEHEHnGsSu1eS1bfBEm1xKlaaKxvJyz0IVQ0RmuMTaQPbr6mtK5NEDaUg4/I+LHGnnOgxHcMMv11SWSKB6SvpAjHIodFO0GyZHRFY+4EE/f9CeS10bMR6yZJ9n9ewsBC4jA+7SEsRk1OXpiWLLJkGqhfmoIvf6GACwSP555wDZyLxjxpUpuyAeuCjvSvverfvx2fIO+Gp/9WSWf8Qs0Rf8PXQP2KAYwiI+TZVdq4TpWceIGaXahHwCeM0PGQIOEtp5eEVa8HhXYfvcTjWvzXMwAMBlM/BnzXUuZNQu4Wm7dcoEvWTrU5IUvr+XdgUzU1V43eK0p3MK1Irkr5vlcZvVcCmyrpLV/+Q6BSZZM8lOCCpTrNP1WXzG6C4rqFIJPOgkB+VdhldAjfoErdfqxVf9vjMY1LC775xXiivX1ZSjA3NusrNFYTfPP5tkueyAAAA=" width="106" height="47" class="img_ev3q"></p>
<p>change <code>chrome://flags/#enable-gpu-rasterization</code> from <code>Default</code> to <code>Disabled</code>.</p>
<p>(It's actually happening very rarely for me, so I put back the setting to <code>Default</code>.)</p>]]></content>
        <category label="chrome" term="chrome"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[xclip and xsel]]></title>
        <id>https://zwyx.dev/til/2023/01/12/xclip and xsel</id>
        <link href="https://zwyx.dev/til/2023/01/12/xclip and xsel"/>
        <updated>2023-01-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[xclip is a command line utility to get or set content in the X selection or clipboard.]]></summary>
        <content type="html"><![CDATA[<p><code>xclip</code> is a command line utility to get or set content in the X selection or clipboard.</p>
<p>It has a strange side effect when used to set things in the clipboard, it make the terminal to hang for a couple of seconds when closed, and more annoyingly it prevent Sublime Merge to terminate a command making use of it. This is probably linked to the fact that <code>xclip</code> starts a background process and leaves it running, as it is necessary for when the clipboard content is retrieved.</p>
<p>After tinkering with it, I wasn't able make it work better. However I discovered <code>xsel</code>, which doesn't the same things without this unwanted side effect.</p>]]></content>
        <category label="xclip" term="xclip"/>
        <category label="xsel" term="xsel"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[inotify watches]]></title>
        <id>https://zwyx.dev/til/2022/12/19/inotify watches</id>
        <link href="https://zwyx.dev/til/2022/12/19/inotify watches"/>
        <updated>2022-12-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[I now use github.com/mikesart/inotify-info which is much faster.]]></summary>
        <content type="html"><![CDATA[<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>EDIT (2025)</div><div class="admonitionContent_BuS1"><p>I now use <a href="https://github.com/mikesart/inotify-info" target="_blank" rel="noopener noreferrer">github.com/mikesart/inotify-info</a> which is much faster.</p><p>Below is the original post, with the old method:</p></div></div>
<p>Check how many inotify watches are being used:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Get the procs sorted by the number of inotify watches</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># @author Carl-Erik Kopseng</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># @latest https://github.com/fatso83/dotfiles/blob/master/utils/scripts/inotify-consumers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Discussion leading up to answer: https://unix.stackexchange.com/questions/15509/whos-consuming-my-inotify-resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># If you need ultimate speed, use https://github.com/fatso83/dotfiles/commit/inotify-consumers-v1-fastest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># # Speed enhancements by Simon Matter &lt;simon.matter@invoca.ch&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># A later PR introduced a significant slowdown to gain better output, but it is insignificant on most machines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># See this for details: https://github.com/fatso83/dotfiles/pull/10#issuecomment-1122374716</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">%</span><span class="token string variable" style="color:#36acaa">${WLEN}</span><span class="token string" style="color:#e3116c">s  %</span><span class="token string variable" style="color:#36acaa">${WLEN}</span><span class="token string" style="color:#e3116c">s</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"INOTIFY"</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"INSTANCES"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"%</span><span class="token string variable" style="color:#36acaa">${WLEN}</span><span class="token string" style="color:#e3116c">s  %</span><span class="token string variable" style="color:#36acaa">${WLEN}</span><span class="token string" style="color:#e3116c">s</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"WATCHES"</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"PER   "</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"%</span><span class="token string variable" style="color:#36acaa">${WLEN}</span><span class="token string" style="color:#e3116c">s  %</span><span class="token string variable" style="color:#36acaa">${WLEN}</span><span class="token string" style="color:#e3116c">s  %s</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">" COUNT "</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"PROCESS "</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">"PID USER         COMMAND"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">printf</span><span class="token plain"> -- </span><span class="token string" style="color:#e3116c">"------------------------------------------------------------</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    generateData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">usage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Usage: </span><span class="token string variable" style="color:#36acaa">$0</span><span class="token string" style="color:#e3116c"> [--help|--limits]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    -l, --limits    Will print the current related limits and how to change them</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    -h, --help      Show this help</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">FYI:  Check out Michael Sartain's C++ take on this script. The native executable</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      is much faster, modern and feature rich. It can be found at</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      https://github.com/mikesart/inotify-info</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">limits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">Current limits</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">-------------</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sysctl</span><span class="token plain"> fs.inotify.max_user_instances fs.inotify.max_user_watches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Changing settings permanently</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">-----------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">sudo sysctl -p # re-read config</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">generateData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> PROC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> PID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> CNT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> INSTANCES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> TOT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> TOTINSTANCES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># read process list into cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PSLIST</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">ps</span><span class="token string variable" style="color:#36acaa"> ax </span><span class="token string variable parameter variable" style="color:#36acaa">-o</span><span class="token string variable" style="color:#36acaa"> pid,user</span><span class="token string variable operator" style="color:#393A34">=</span><span class="token string variable" style="color:#36acaa">WIDE-COLUMN,command $COLSTRING</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">INOTIFY</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">find</span><span class="token string variable" style="color:#36acaa"> /proc/</span><span class="token string variable punctuation" style="color:#393A34">[</span><span class="token string variable number" style="color:#36acaa">0</span><span class="token string variable" style="color:#36acaa">-9</span><span class="token string variable punctuation" style="color:#393A34">]</span><span class="token string variable" style="color:#36acaa">*/fdinfo </span><span class="token string variable parameter variable" style="color:#36acaa">-type</span><span class="token string variable" style="color:#36acaa"> f </span><span class="token string variable operator file-descriptor important" style="color:#393A34">2</span><span class="token string variable operator" style="color:#393A34">&gt;</span><span class="token string variable" style="color:#36acaa">/dev/null </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">xargs</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">grep</span><span class="token string variable" style="color:#36acaa"> ^inotify </span><span class="token string variable operator file-descriptor important" style="color:#393A34">2</span><span class="token string variable operator" style="color:#393A34">&gt;</span><span class="token string variable" style="color:#36acaa">/dev/null</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">INOTIFYCNT</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable builtin class-name" style="color:#36acaa">echo</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">"</span><span class="token string variable string variable" style="color:#36acaa">$INOTIFY</span><span class="token string variable string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">cut</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-d</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">"/"</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-s</span><span class="token string variable" style="color:#36acaa"> --output-delimiter</span><span class="token string variable operator" style="color:#393A34">=</span><span class="token string variable string" style="color:#e3116c">" "</span><span class="token string variable" style="color:#36acaa">  </span><span class="token string variable parameter variable" style="color:#36acaa">-f</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable number" style="color:#36acaa">3</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable function" style="color:#d73a49">uniq</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-c</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">sed</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-e</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">'s/:.*//'</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># unique instances per process is denoted by number of inotify FDs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">INOTIFYINSTANCES</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable builtin class-name" style="color:#36acaa">echo</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">"</span><span class="token string variable string variable" style="color:#36acaa">$INOTIFY</span><span class="token string variable string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">cut</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-d</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">"/"</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-s</span><span class="token string variable" style="color:#36acaa"> --output-delimiter</span><span class="token string variable operator" style="color:#393A34">=</span><span class="token string variable string" style="color:#e3116c">" "</span><span class="token string variable" style="color:#36acaa">   </span><span class="token string variable parameter variable" style="color:#36acaa">-f</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable number" style="color:#36acaa">3,5</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">sed</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-e</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">'s/:.*//'</span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">uniq</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable function" style="color:#d73a49">awk</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">'{print $1}'</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable function" style="color:#d73a49">uniq</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-c</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">INOTIFYUSERINSTANCES</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"$(echo "</span><span class="token string variable" style="color:#36acaa">$INOTIFY</span><span class="token string" style="color:#e3116c">" | cut -d "/" -s --output-delimiter=" "   -f 3,5 | sed -e 's/:.*//' | uniq |</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    	     while read PID FD; do echo </span><span class="token string variable" style="color:#36acaa">$PID</span><span class="token string" style="color:#e3116c"> </span><span class="token string variable" style="color:#36acaa">$FD</span><span class="token string" style="color:#e3116c"> </span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">grep</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-e</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">"^ *</span><span class="token string variable string variable" style="color:#36acaa">${PID}</span><span class="token string variable string" style="color:#e3116c"> "</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">&lt;&lt;&lt;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">"</span><span class="token string variable string variable" style="color:#36acaa">$PSLIST</span><span class="token string variable string" style="color:#e3116c">"</span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable function" style="color:#d73a49">awk</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">'{print $2}'</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">; done | cut -d"</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"  -f 3 | sort | uniq -c |sort -nr)"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$INOTIFYCNT</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token builtin class-name">read</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-rs</span><span class="token plain"> CNT PROC</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># count watches of processes found</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">${PROC}</span><span class="token string" style="color:#e3116c">,</span><span class="token string variable" style="color:#36acaa">${CNT}</span><span class="token string" style="color:#e3116c">,</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable builtin class-name" style="color:#36acaa">echo</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">"</span><span class="token string variable string variable" style="color:#36acaa">$INOTIFYINSTANCES</span><span class="token string variable string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">grep</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">" </span><span class="token string variable string variable" style="color:#36acaa">${PROC}</span><span class="token string variable string" style="color:#e3116c">$"</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable function" style="color:#d73a49">awk</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">'{print $1}'</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">",0,"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic"># remove entires without watches</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">sort</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">","</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-k</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2,3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># sort to begin with highest numbers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                                </span><span class="token comment" style="color:#999988;font-style:italic"># group commands so that $TOT is visible in the printf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	    </span><span class="token assign-left variable environment constant" style="color:#36acaa">IFS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">","</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token builtin class-name">read</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-rs</span><span class="token plain"> PID CNT INSTANCES</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># show watches and corresponding process info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"%</span><span class="token string variable" style="color:#36acaa">$((</span><span class="token string variable" style="color:#36acaa"> WLEN </span><span class="token string variable operator" style="color:#393A34">-</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable number" style="color:#36acaa">2</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable" style="color:#36acaa">))</span><span class="token string" style="color:#e3116c">d  %</span><span class="token string variable" style="color:#36acaa">$((</span><span class="token string variable" style="color:#36acaa"> WLEN </span><span class="token string variable operator" style="color:#393A34">-</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable number" style="color:#36acaa">2</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable" style="color:#36acaa">))</span><span class="token string" style="color:#e3116c">d     %s</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$CNT</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$INSTANCES</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">grep</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-e</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">"^ *</span><span class="token string variable string variable" style="color:#36acaa">${PID}</span><span class="token string variable string" style="color:#e3116c"> "</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">&lt;&lt;&lt;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">"</span><span class="token string variable string variable" style="color:#36acaa">$PSLIST</span><span class="token string variable string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token assign-left variable" style="color:#36acaa">TOT</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$((</span><span class="token variable" style="color:#36acaa"> TOT </span><span class="token variable operator" style="color:#393A34">+</span><span class="token variable" style="color:#36acaa"> CNT </span><span class="token variable" style="color:#36acaa">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token assign-left variable" style="color:#36acaa">TOTINSTANCES</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$((</span><span class="token variable" style="color:#36acaa"> TOTINSTANCES </span><span class="token variable operator" style="color:#393A34">+</span><span class="token variable" style="color:#36acaa"> INSTANCES</span><span class="token variable" style="color:#36acaa">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	    </span><span class="token comment" style="color:#999988;font-style:italic"># These stats should be per-user as well, since inotify limits are per-user..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">%</span><span class="token string variable" style="color:#36acaa">$((</span><span class="token string variable" style="color:#36acaa"> WLEN </span><span class="token string variable operator" style="color:#393A34">-</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable number" style="color:#36acaa">2</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable" style="color:#36acaa">))</span><span class="token string" style="color:#e3116c">d  %s</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$TOT</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"WATCHES TOTAL COUNT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the total across different users is somewhat meaningless, not printing for now.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            printf "\n%$(( WLEN - 2 ))d  %s\n" "$TOTINSTANCES" "TOTAL INSTANCES COUNT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"INotify instances per user (e.g. limits specified by fs.inotify.max_user_instances): "</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"INSTANCES    USER"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-----------  ------------------"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$INOTIFYUSERINSTANCES</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">column</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># get terminal width</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">declare</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">COLS</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">tput cols </span><span class="token variable operator file-descriptor important" style="color:#393A34">2</span><span class="token variable operator" style="color:#393A34">&gt;</span><span class="token variable" style="color:#36acaa">/dev/null </span><span class="token variable operator" style="color:#393A34">||</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable builtin class-name" style="color:#36acaa">echo</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">80</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">declare</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">WLEN</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">declare</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">COLSTRING</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"--columns </span><span class="token string variable" style="color:#36acaa">$((</span><span class="token string variable" style="color:#36acaa"> COLS </span><span class="token string variable operator" style="color:#393A34">-</span><span class="token string variable" style="color:#36acaa"> WLEN </span><span class="token string variable" style="color:#36acaa">))</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># get terminal width</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"--limits"</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-l"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    limits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"--help"</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-h"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># added this line and moved some declarations to allow for the full display instead of a truncated version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"--full"</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-f"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">unset</span><span class="token plain"> COLSTRING</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">Unknown parameter '</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">'</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token file-descriptor important">&amp;2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main</span><br></span></code></pre></div></div>
<p><a href="https://github.com/fatso83/dotfiles/blob/master/utils/scripts/inotify-consumers" target="_blank" rel="noopener noreferrer">https://github.com/fatso83/dotfiles/blob/master/utils/scripts/inotify-consumers</a></p>]]></content>
        <category label="inotify" term="inotify"/>
        <category label="file system" term="file system"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[rsync and file renames]]></title>
        <id>https://zwyx.dev/til/2022/12/19/rsync and file renames</id>
        <link href="https://zwyx.dev/til/2022/12/19/rsync and file renames"/>
        <updated>2022-12-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[rsync doesn't handle file/folder renames well: if a folder containing lots of big files (a photos/videos library) is renamed in the source, then the existing files in the destination will be deleted, and all files will be copied again to the destination.]]></summary>
        <content type="html"><![CDATA[<p><code>rsync</code> doesn't handle file/folder renames well: if a folder containing lots of big files (a photos/videos library) is renamed in the source, then the existing files in the destination will be deleted, and all files will be copied again to the destination.</p>
<p><a href="https://github.com/bcpierce00/unison" target="_blank" rel="noopener noreferrer">Unison</a> appears to handle file renames, but what it actually does is detecting that the files already exist in the destination, and making a copy of them in the destination, from the destination. This saves bandwidth, but is still slow and will stress hard drives for no reason.</p>
<p>A tool made by one single person addresses this issue perfectly: <a href="https://github.com/m-manu/rsync-sidekick" target="_blank" rel="noopener noreferrer"><code>rsync-sidekick</code></a></p>
<p>The author mentions that the tool doesn't make any changes, but to make sure of it, we can run it in a Docker container with readonly volumes. It will output a list of commands to rename and move stuff in the destination to reproduce the renames/moves made in the source.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage<a href="https://zwyx.dev/til/2022/12/19/rsync%20and%20file%20renames#usage" class="hash-link" aria-label="Direct link to Usage" title="Direct link to Usage" translate="no">​</a></h3>
<ul>
<li>Build the container:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> rsync-sidekick </span><span class="token builtin class-name">.</span><br></span></code></pre></div></div>
<ul>
<li>Run it:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">--rm</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">source-path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:/sync-src:ro </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">destination-path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:/sync-dst:ro </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rsync-sidekick </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	/bin/bash </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rsync-sidekick -shellscript /sync-src/ /sync-dst/ &amp;&amp; echo &amp;&amp; cat sync_actions_*.sh"</span><br></span></code></pre></div></div>
<ul>
<li>
<p>Retrieve the output, check it visually, replace <code>sync-src</code> and <code>sync-dst</code>, and run it.</p>
</li>
<li>
<p>Run <code>rsync</code> on dry-run:</p>
</li>
</ul>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rsync</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-ruvin</span><span class="token plain"> /</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">source-path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/ /</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">destination-path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><br></span></code></pre></div></div>
<ul>
<li>Check the output; if all is ok, run <code>rsync</code>:</li>
</ul>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rsync</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-ruvi</span><span class="token plain"> /</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">source-path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/ /</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">destination-path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="remote-directories">Remote directories<a href="https://zwyx.dev/til/2022/12/19/rsync%20and%20file%20renames#remote-directories" class="hash-link" aria-label="Direct link to Remote directories" title="Direct link to Remote directories" translate="no">​</a></h3>
<p><code>rsync-sidekick</code> only supports local directories at the moment, so to use it with a remote one, we need to mount the directory locally. Example with SSH:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> ~/remote-dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sshfs </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">server</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">path-on-server</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ~/remote-dir</span><br></span></code></pre></div></div>
<p>Then you can use <code>~/remote-dir</code> as a local directory.</p>
<p>To unmount it, run:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fusermount </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token plain"> ~/remote-dir</span><br></span></code></pre></div></div>]]></content>
        <category label="rsync" term="rsync"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[JSON stringify circular references]]></title>
        <id>https://zwyx.dev/til/2022/12/05/JSON stringify circular references</id>
        <link href="https://zwyx.dev/til/2022/12/05/JSON stringify circular references"/>
        <updated>2022-12-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Not really a TIL, but more a knack]]></summary>
        <content type="html"><![CDATA[<p>Not really a TIL, but more a knack: stringify an object containing circular references:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">safeStringify</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">obj</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> indent </span><span class="token parameter operator" style="color:#393A34">=</span><span class="token parameter"> </span><span class="token parameter number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> cache </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> retVal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		obj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">key</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"object"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">includes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Duplicate reference found, discard key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> value </span><span class="token comment" style="color:#999988;font-style:italic">// Store value in our collection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		indent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	cache </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> retVal</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Use like:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">safeStringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>From <a href="https://stackoverflow.com/questions/11616630/how-can-i-print-a-circular-structure-in-a-json-like-format" target="_blank" rel="noopener noreferrer">here</a>.</p>]]></content>
        <category label="json" term="json"/>
        <category label="stringify" term="stringify"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[wget for FTP]]></title>
        <id>https://zwyx.dev/til/2022/11/23/wget for FTP</id>
        <link href="https://zwyx.dev/til/2022/11/23/wget for FTP"/>
        <updated>2022-11-23T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Download the content of an FTP folder with wget:]]></summary>
        <content type="html"><![CDATA[<p>Download the content of an FTP folder with <code>wget</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--user</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">username</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> --ask-password </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain"> ftp://</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">url</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>Although it took minutes to download 10 MB...</p>]]></content>
        <category label="wget" term="wget"/>
        <category label="ftp" term="ftp"/>
        <category label="cli" term="cli"/>
        <category label="command" term="command"/>
    </entry>
</feed>