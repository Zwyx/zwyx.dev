<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-til" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Zwyx&#x27;s Today I Learnt | Zwyx</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zwyx.dev/img/Zwyx-236x236-android-chrome-192x192.webp"><meta data-rh="true" name="twitter:image" content="https://zwyx.dev/img/Zwyx-236x236-android-chrome-192x192.webp"><meta data-rh="true" property="og:url" content="https://zwyx.dev/til"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="software development, web"><meta data-rh="true" property="og:title" content="Zwyx&#x27;s Today I Learnt | Zwyx"><meta data-rh="true" name="description" content="Today I Learnt, about web and dev"><meta data-rh="true" property="og:description" content="Today I Learnt, about web and dev"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/Zwyx-220x220-rounded-favicon.ico"><link data-rh="true" rel="canonical" href="https://zwyx.dev/til"><link data-rh="true" rel="alternate" href="https://zwyx.dev/til" hreflang="en"><link data-rh="true" rel="alternate" href="https://zwyx.dev/til" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ECBLYDEE9A-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"Blog","@id":"https://zwyx.dev/til","mainEntityOfPage":"https://zwyx.dev/til","headline":"Zwyx's Today I Learnt","description":"Today I Learnt, about web and dev","blogPost":[{"@type":"BlogPosting","@id":"https://zwyx.dev/til/2025/08/01/Custom clone function in JavaScript","mainEntityOfPage":"https://zwyx.dev/til/2025/08/01/Custom clone function in JavaScript","url":"https://zwyx.dev/til/2025/08/01/Custom clone function in JavaScript","headline":"Custom clone function in JavaScript","name":"Custom clone function in JavaScript","description":"We can easily clone an object in JavaScript using the structuredClone method, Ramda's clone, or Lodash's cloneDeep.","datePublished":"2025-08-01T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://zwyx.dev/til/2025/02/05/ddc-ci","mainEntityOfPage":"https://zwyx.dev/til/2025/02/05/ddc-ci","url":"https://zwyx.dev/til/2025/02/05/ddc-ci","headline":"DDC/CI","name":"DDC/CI","description":"The DDC/CI standard (introduced in 1998!) allows a computer to send commands to external monitors.","datePublished":"2025-02-05T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://zwyx.dev/til/2025/01/24/Annotated and lightweight tags","mainEntityOfPage":"https://zwyx.dev/til/2025/01/24/Annotated and lightweight tags","url":"https://zwyx.dev/til/2025/01/24/Annotated and lightweight tags","headline":"Annotated and lightweight tags","name":"Annotated and lightweight tags","description":"Git has two kinds of tags: annotated and lightweight.","datePublished":"2025-01-24T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://zwyx.dev/til/2024/03/27/interactive-widget","mainEntityOfPage":"https://zwyx.dev/til/2024/03/27/interactive-widget","url":"https://zwyx.dev/til/2024/03/27/interactive-widget","headline":"interactive-widget","name":"interactive-widget","description":"The viewport meta tag option interactive-widget allows us to choose what the browser should do with our page when some overlay elements — such as a phone on-screen keyboard — appear:","datePublished":"2024-03-27T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://zwyx.dev/til/2024/02/01/Fast integer-to-string conversion","mainEntityOfPage":"https://zwyx.dev/til/2024/02/01/Fast integer-to-string conversion","url":"https://zwyx.dev/til/2024/02/01/Fast integer-to-string conversion","headline":"Fast integer-to-string conversion","name":"Fast integer-to-string conversion","description":"This content kept growing, so it has been moved into a blog post.","datePublished":"2024-02-01T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://zwyx.dev/til/2023/12/31/Fast string-to-integer conversion","mainEntityOfPage":"https://zwyx.dev/til/2023/12/31/Fast string-to-integer conversion","url":"https://zwyx.dev/til/2023/12/31/Fast string-to-integer conversion","headline":"Fast string-to-integer conversion","name":"Fast string-to-integer conversion","description":"This content kept growing, so it has been moved into a blog post.","datePublished":"2023-12-31T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://zwyx.dev/til/2023/06/30/GPU rasterization in Chrome","mainEntityOfPage":"https://zwyx.dev/til/2023/06/30/GPU rasterization in Chrome","url":"https://zwyx.dev/til/2023/06/30/GPU rasterization in Chrome","headline":"GPU rasterization in Chrome","name":"GPU rasterization in Chrome","description":"In case of weird text rendering issues in Chrome looking like this:","datePublished":"2023-06-30T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://zwyx.dev/til/2023/01/12/xclip and xsel","mainEntityOfPage":"https://zwyx.dev/til/2023/01/12/xclip and xsel","url":"https://zwyx.dev/til/2023/01/12/xclip and xsel","headline":"xclip and xsel","name":"xclip and xsel","description":"xclip is a command line utility to get or set content in the X selection or clipboard.","datePublished":"2023-01-12T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://zwyx.dev/til/2022/12/19/inotify watches","mainEntityOfPage":"https://zwyx.dev/til/2022/12/19/inotify watches","url":"https://zwyx.dev/til/2022/12/19/inotify watches","headline":"inotify watches","name":"inotify watches","description":"I now use github.com/mikesart/inotify-info which is much faster.","datePublished":"2022-12-19T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://zwyx.dev/til/2022/12/19/rsync and file renames","mainEntityOfPage":"https://zwyx.dev/til/2022/12/19/rsync and file renames","url":"https://zwyx.dev/til/2022/12/19/rsync and file renames","headline":"rsync and file renames","name":"rsync and file renames","description":"rsync doesn't handle file/folder renames well: if a folder containing lots of big files (a photos/videos library) is renamed in the source, then the existing files in the destination will be deleted, and all files will be copied again to the destination.","datePublished":"2022-12-19T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://zwyx.dev/til/2022/12/05/JSON stringify circular references","mainEntityOfPage":"https://zwyx.dev/til/2022/12/05/JSON stringify circular references","url":"https://zwyx.dev/til/2022/12/05/JSON stringify circular references","headline":"JSON stringify circular references","name":"JSON stringify circular references","description":"Not really a TIL, but more a knack","datePublished":"2022-12-05T00:00:00.000Z","author":[],"keywords":[]},{"@type":"BlogPosting","@id":"https://zwyx.dev/til/2022/11/23/wget for FTP","mainEntityOfPage":"https://zwyx.dev/til/2022/11/23/wget for FTP","url":"https://zwyx.dev/til/2022/11/23/wget for FTP","headline":"wget for FTP","name":"wget for FTP","description":"Download the content of an FTP folder with wget:","datePublished":"2022-11-23T00:00:00.000Z","author":[],"keywords":[]}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Zwyx&#39;s blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Zwyx&#39;s blog Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Zwyx&#39;s blog JSON Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Zwyx" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/til/rss.xml" title="Zwyx&#39;s TILs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/til/atom.xml" title="Zwyx&#39;s TILs Atom Feed">
<link rel="alternate" type="application/json" href="/til/feed.json" title="Zwyx&#39;s TILs JSON Feed">
<script src="https://plsbl.zwyx.dev/js/script.js" defer="defer" data-domain="zwyx.dev"></script><link rel="stylesheet" href="/assets/css/styles.a6c36bf8.css">
<script src="/assets/js/runtime~main.68305485.js" defer="defer"></script>
<script src="/assets/js/main.c1b8f0ec.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/Zwyx-236x236-android-chrome-192x192.webp"><link rel="preload" as="image" href="/assets/images/2024-03-27-interactive-widget-visual-comparison-all-ff711d1c9df866930cdc6b23602ac624.webp"><link rel="preload" as="image" href="/assets/images/2024-03-27-interactive-widget-babel-2b3e7ed27a3f3bce5ac7359e6cff7ecb.webp"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Zwyx-236x236-android-chrome-192x192.webp" alt="Zwyx logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/Zwyx-236x236-android-chrome-192x192.webp" alt="Zwyx logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/blog">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/til">Today I Learnt</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://github.com/Zwyx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Latest TILs</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/til/2025/08/01/Custom clone function in JavaScript">Custom clone function in JavaScript</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/til/2025/02/05/ddc-ci">DDC/CI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/til/2025/01/24/Annotated and lightweight tags">Annotated and lightweight tags</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/til/2024/03/27/interactive-widget">interactive-widget</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/til/2024/02/01/Fast integer-to-string conversion">Fast integer-to-string conversion</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/til/2023/12/31/Fast string-to-integer conversion">Fast string-to-integer conversion</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/til/2023/06/30/GPU rasterization in Chrome">GPU rasterization in Chrome</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/til/2023/01/12/xclip and xsel">xclip and xsel</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/til/2022/12/19/inotify watches">inotify watches</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/til/2022/12/19/rsync and file renames">rsync and file renames</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/til/2022/12/05/JSON stringify circular references">JSON stringify circular references</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/til/2022/11/23/wget for FTP">wget for FTP</a></li></ul></div></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/til/2025/08/01/Custom clone function in JavaScript">Custom clone function in JavaScript</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-08-01T00:00:00.000Z">August 1, 2025</time></div></header><div class="markdown"><p>We can easily clone an object in JavaScript using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/structuredClone" target="_blank" rel="noopener noreferrer"><code>structuredClone</code></a> method, Ramda&#x27;s <a href="https://ramdajs.com/docs/#clone" target="_blank" rel="noopener noreferrer"><code>clone</code></a>, or Lodash&#x27;s <a href="https://lodash.com/docs/4.17.15#cloneDeep" target="_blank" rel="noopener noreferrer"><code>cloneDeep</code></a>.</p>
<p>However, writing our own cloning function can lead to much better performances.</p>
<p>For the Codewars kata <a href="https://www.codewars.com/kata/688b957a12698cb53d5959fe" target="_blank" rel="noopener noreferrer">Win at Skyjo</a>, the function <a href="https://github.com/Zwyx/codewars-skyjo-resources/blob/df3cdcc47cf16b8904bd5f3fae015f25bc298cb0/src/utils.ts#L59" target="_blank" rel="noopener noreferrer"><code>getPlayersColumnsClone</code></a> deep clones an array of five arrays, themselves arrays of four arrays, themselves arrays of three arrays of simple objects with four properties.</p>
<p>Here&#x27;s how this function performs 100,000 cloning operations compare to other methods:</p>
<!-- -->
<!-- -->
<code>getPlayersColumnsClone</code> <!-- -->0.06<!-- --> s<div style="margin-top:2px;margin-bottom:12px;display:flex;align-items:center"><span style="display:inline-block;width:0.6960556844547564%;height:8px;background-color:var(--ifm-link-color);border-radius:5px"></span></div><code>structuredClone</code> <!-- -->2.54<!-- --> s<div style="margin-top:2px;margin-bottom:12px;display:flex;align-items:center"><span style="display:inline-block;width:29.46635730858469%;height:8px;background-color:var(--ifm-link-color);border-radius:5px"></span></div><code>Lodash.cloneDeep</code> <!-- -->4.68<!-- --> s<div style="margin-top:2px;margin-bottom:12px;display:flex;align-items:center"><span style="display:inline-block;width:54.292343387471%;height:8px;background-color:var(--ifm-link-color);border-radius:5px"></span></div><code>Ramda.clone</code> <!-- -->8.62<!-- --> s<div style="margin-top:2px;margin-bottom:12px;display:flex;align-items:center"><span style="display:inline-block;width:100%;height:8px;background-color:var(--ifm-link-color);border-radius:5px"></span></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Benchmark implementation</summary><div><div class="collapsibleContent_i85q"><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Lodash </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;lodash&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> Ramda </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ramda&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUMBER_OF_PLAYERS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUMBER_OF_COLUMNS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUMBER_OF_ROWS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> playersColumns </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> length</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUMBER_OF_PLAYERS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token builtin">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> length</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUMBER_OF_COLUMNS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token builtin">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> length</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NUMBER_OF_ROWS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			card</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			visible</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> cloneFunctions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Ramda</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clone</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Lodash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cloneDeep</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	structuredClone</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	getPlayersColumnsClone</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> cloneFunction </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> cloneFunctions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Cloning with &#x27;</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">cloneFunction</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">&#x27;...</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> startTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> performance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100_000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token function" style="color:#d73a49">cloneFunction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">playersColumns</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> duration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">performance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Took </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">duration</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c"> s</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div></div></div></details></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/javascript">javascript</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/clone">clone</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/bun">bun</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/node">node</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/til/2025/02/05/ddc-ci">DDC/CI</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-02-05T00:00:00.000Z">February 5, 2025</time></div></header><div class="markdown"><p>The <a href="https://en.wikipedia.org/wiki/Display_Data_Channel#DDC/CI" target="_blank" rel="noopener noreferrer">DDC/CI</a> standard (introduced in 1998!) allows a computer to send commands to external monitors.</p>
<p>For instance, we can programmatically set the brightness of all our monitors:</p>
<ul>
<li>install <a href="https://github.com/rockowitz/ddcutil" target="_blank" rel="noopener noreferrer">ddcutil</a>:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> ddcutil</span><br></span></code></pre></div></div>
<ul>
<li>create a shortcut associated with a script to switch between bright and dim:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">cat</span><span class="token string variable" style="color:#36acaa"> /sys/class/backlight/intel_backlight/brightness</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;960&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic"># Set laptop monitor&#x27;s brightness</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">57984</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> /sys/class/backlight/intel_backlight/brightness</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic"># Set external monitors&#x27; brightness</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> ddcutil setvcp 0x10 </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">960</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> /sys/class/backlight/intel_backlight/brightness</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> ddcutil setvcp 0x10 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre></div></div>
<p><code>0x10</code> is the code for <code>brightness</code>. Run <code>sudo ddcutil detect</code> to list the monitors <code>ddcutil</code> can work with, and <code>sudo ddcutil getvcp all</code> to list the features available.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Because <code>sudo</code> is required, the shortcut&#x27;s command needs to use <code>pkexec</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pkexec /path/to/switch-brightness.sh</span><br></span></code></pre></div></div></div></div>
<p>And by the way, here&#x27;s another script, to switch between light and dark themes:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">gsettings get org.gnome.desktop.interface gtk-theme</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&#x27;Yaru&#x27;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	gsettings </span><span class="token builtin class-name">set</span><span class="token plain"> org.gnome.desktop.interface color-scheme </span><span class="token string" style="color:#e3116c">&quot;prefer-dark&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	gsettings </span><span class="token builtin class-name">set</span><span class="token plain"> org.gnome.desktop.interface gtk-theme </span><span class="token string" style="color:#e3116c">&quot;Yaru-dark&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	gsettings </span><span class="token builtin class-name">set</span><span class="token plain"> org.gnome.desktop.interface color-scheme </span><span class="token string" style="color:#e3116c">&quot;prefer-light&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	gsettings </span><span class="token builtin class-name">set</span><span class="token plain"> org.gnome.desktop.interface gtk-theme </span><span class="token string" style="color:#e3116c">&quot;Yaru&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre></div></div></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/til/2025/01/24/Annotated and lightweight tags">Annotated and lightweight tags</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-01-24T00:00:00.000Z">January 24, 2025</time></div></header><div class="markdown"><p>Git has <a href="https://git-scm.com/book/en/v2/Git-Basics-Tagging" target="_blank" rel="noopener noreferrer">two kinds of tags</a>: <em>annotated</em> and <em>lightweight</em>.</p>
<ul>
<li>An annotated tag is stored as an object. It contains the name of the user who created it (the <em>tagger</em>), it can be signed, etc.</li>
<li>A lightweight tag is like a branch that doesn&#x27;t change.</li>
</ul>
<p>Although using one kind or the other doesn&#x27;t change anything most of the times, there are cases where knowing the difference is useful. GitHub Actions for instance, has a different behaviour for the two: when we push a <strong>lightweight</strong> tag which is on the latest commit of branch <code>main</code>, <code>github.event.base_ref</code> contains <code>refs/heads/main</code>. This allows us to run a workflow on new tags only created on the main branch:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;v[0-9]+.[0-9]+.[0-9]+&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build-website</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github.event.base_ref == &#x27;refs/heads/main&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre></div></div>
<p>However, <strong>this doesn&#x27;t work if the tag is annotated</strong>.</p>
<p>Commands like <code>npm version</code> create annotated tags, so we can just add a <code>postversion</code> script in <code>package.json</code> to convert the newly created annotated tag to a lightweight one:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">tag</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">git</span><span class="token variable" style="color:#36acaa"> tag --points-at HEAD</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> tag </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$tag</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> tag </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$tag</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> HEAD</span><br></span></code></pre></div></div>
<p>See the whole files at <a href="https://github.com/Zwyx/library-of-babel" target="_blank" rel="noopener noreferrer">github.com/Zwyx/library-of-babel</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/git">git</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/til/2024/03/27/interactive-widget">interactive-widget</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-03-27T00:00:00.000Z">March 27, 2024</time></div></header><div class="markdown"><p>The <code>viewport</code> meta tag option <code>interactive-widget</code> allows us to choose what the browser should do with our page when some overlay elements — such as a phone on-screen keyboard — appear:</p>
<!-- -->
<div class="imageWrapper_u91s withLegend_q8O0"><div class="frame_zT4L"><img class="image_Y_cJ" src="/assets/images/2024-03-27-interactive-widget-visual-comparison-all-ff711d1c9df866930cdc6b23602ac624.webp" alt="interactive-widget options comparison"></div><div class="legend_xj0V"><code>interactive-widget</code> options comparison. The difference between<!-- --> <code>resizes-visual</code> and <code>overlays-content</code> is that<!-- --> <code>resizes-visual</code> allows the user to scroll the page up to see the sticky element at the bottom, whereas <code>overlays-content</code> <!-- -->doesn&#x27;t.</div></div>
<p>Chrome&#x27;s default behaviour on Android, before version 108, was <code>resizes-content</code> — it is now <code>resizes-visual</code>.</p>
<p>For example, the <a href="https://babel.zwyx.dev/" target="_blank" rel="noopener noreferrer">Library of Babel</a>&#x27;s <code>viewport</code> meta tag is now:</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">	</span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">viewport</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">	</span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">width=device-width, initial-scale=1.0, interactive-widget=resizes-content</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f"></span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre></div></div>
<p>This allows the sticky pagination component to be always visible when the on-screen keyboard is open:</p>
<div style="text-align:center"><div class="imageWrapper_u91s withLegend_q8O0"><div class="frame_zT4L"><img class="image_Y_cJ" src="/assets/images/2024-03-27-interactive-widget-babel-2b3e7ed27a3f3bce5ac7359e6cff7ecb.webp" alt="Example on the Library of Babel" width="350"></div><div class="legend_xj0V">The keyboard is<!-- --> <a href="https://github.com/dessalines/thumb-key" target="_blank" rel="noopener noreferrer">Thumb-Key</a>.</div></div></div>
<p>Without <code>interactive-widget</code>, scrolling down while the keyboard was open made the sticky pagination component to disappear.</p>
<p>Read more at <a href="https://developer.chrome.com/blog/viewport-resize-behavior" target="_blank" rel="noopener noreferrer">developer.chrome.com/blog/viewport-resize-behavior</a> (which is the source of the comparison image above).</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/viewport">viewport</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/til/2024/02/01/Fast integer-to-string conversion">Fast integer-to-string conversion</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-02-01T00:00:00.000Z">February 1, 2024</time></div></header><div class="markdown"><p>This content kept growing, so it has been moved into a <a href="/blog/base-conversions-with-big-numbers-in-javascript">blog post</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/javascript">javascript</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/v-8">v8</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/string">string</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/integer">integer</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/til/2023/12/31/Fast string-to-integer conversion">Fast string-to-integer conversion</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-31T00:00:00.000Z">December 31, 2023</time></div></header><div class="markdown"><p>This content kept growing, so it has been moved into a <a href="/blog/base-conversions-with-big-numbers-in-javascript">blog post</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/javascript">javascript</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/v-8">v8</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/string">string</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/integer">integer</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/til/2023/06/30/GPU rasterization in Chrome">GPU rasterization in Chrome</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-06-30T00:00:00.000Z">June 30, 2023</time></div></header><div class="markdown"><p>In case of weird text rendering issues in Chrome looking like this:</p>
<p><img decoding="async" loading="lazy" alt="Text issue" src="data:image/webp;base64,UklGRowHAABXRUJQVlA4IIAHAACQKACdASpqAC8APjEUh0KiIQvOzowQAYJQBmYuhzL1l7AcRS216ANtf+IHsL/Yr1uPQB5rvpN+pR/Ov8P7AH7Aeml7H/91/5XpmatJ0A7Jv6X+Qnm33ku2HrN+Om+s/sH4ze4f8S+q31b8lv6j+6HElfs3qBem/6t+WfBM0U/tfqBepXzT/G/mB5H38B+QHuZ9Kf8B6Cv9m/Kr+pfCv9J/zPiDdgf1X3AP4n/Lf8R/c/2o/vX0dftH+5/t35Heyb8l/rf+v/xXwB/yP+ef53+5/ur/nv//9O/sI/bf2Q/1zY21m+dEgSFn10Zai6oDQ3pL0WpskwzW6lYRrmCf/LmPWky9DUn97hX/fTkBtS3g+/6U1wkDqF/BU13OX3//BLxoRiQbOMmQKko3T+FNFQC+pmwF/reoziciFm6nm/SdUxKE5SD13ld9cIJyeFwA/v/7OATefdES2mbQXP1+sqyYnsJMeQjD525Odpl5FmTM5kKqo73jxr8keTzVSW0Qr+NofLGR7MFhpSPLTmU0QqN1ZvOeA1NT5cBtEpgVhMySOfgZbtGw15WOY7DRfOuvjBThi7i3HPyLG+lhjsXlH/vWNmf97KoeWdQOeO2dbdUUj8V1UQvwgKE5Ks2GxVx0Ux6mOHdudbOKRhFmLlLFEucdysqA77LRp4ba155FZEypPzkcZsLhnrp4INu/9TCeFQXnqYPG0bK14J8TZqFWDoIZFSeiBvFAbQwi25eM05iPwyorW2hJz7H+Ffhlcz6H8sIiRv8CmeJ+EeQj+fcNSwr8Yj2cTSP2wktflr1V1rZaQ/Djs0dY/cl/RAe3QcY9D1v7l3zONnsRbTvOgI6G2okF9hrXOEddn/uM8PqyQyjpNiiQ6g8Za81ZAfmsim4bUBFljh+e/i8p/XPdqA8N0GxSqfqxanESpLxFTwEF8cEMRrFet6L6k3al0plcpAnZzHZKss+vrtRd5UENRpn5zD5HOGRVcuKtIniWfwj7fwoC3Oe+kuNwzksGYGgs+/5VgQlkYQdDBfSSVniItynHSxNs1PYLGe1csB5j7WytoL7OcN2jZ889iOMNOgOhV/G2NGL7E/guMwdy92d6Oz96/l1dlvYst93HiHus/u6wU0WjGAb+NQXrm+vo6YxU0S1DXnWImk+/kXOyS6W9HNDN4wz4RpOGwNYNZ7MnFqZZaQHfkNo+qMFiqGM1H40CQyPGTn65F2xo6dd4hOZZf+dqfd8bwnbkbsUws8zed8axH18mvjtsXsCluBMv8TTxxkD3yIkNkq4CSyhFCGvqjaZtlII/BspjiotRkfzRbKPEFnLd/HXKhD8FCgft9BNWj+iblIaYubtUSqSXF4/Rp1NlTzpiV80v1UzoDSZNjhomp9g/BV34RwmqRgZ1ZYIN/YMShkr4U9ocTZduxMj1co3XvjLrTLHpg85gJDwukrkN3sNS3R5McaGMrD/fuJ1WQZfgH+IyMV4GQLbQ8gUoDMMPk4EjLmeHXFGkN95EvYQWP3sqZqLgMcIft2Drw4ozYV+SSbDQbp22EXC6wKTcmtEl1wohLCiSwA3UnyUnU6OzqFZ83LIMf+M03kDHyc4KM0ixcWt8zy+tM5nOPhLGILK9yX77v8QSLwJ0xL5eI/TzH0oJ0soYnywHX/afXAEzaTqiQzL24v5I1DSgsFBEUdyuTyyrXBtC/6PEkj0DPdpYNNsfIhu3u7h4WfjDexenIM82n4Qx4XwdmTcXPH73jaAYuQg2e03WF6ozmSAlRVvCabnl8FO7s31xFjWUmFl1FCTefMmflxUZFl3LeQu9s+nbeGnOE41kfT7qBD//zJA9wieBTXK3LCsK0klH1aQmelxLux1uvgO4Lrl/D2rNtt0h+lKWtSinvzP20XRke5Ynwy8DkyHvQrJOe146pCD7bMvxGHW392H+zt74mD9K3X7NmorHQyYeVpG19033N9fYStZvPR+hV/92U3JrUSPI5KtrdEyCsP5/T6nS1qUReIVFQmiFds/LbutHVph6SQwpAo5zp9HuMtN6ZLMd3uVZpMKnvvhnh8Bz1u8occ6Fff+rP9egGNt/5YaTL21LiTmxAeNfNHVdDRRH0XR9hVa7fmPl/qQEHEHnGsSu1eS1bfBEm1xKlaaKxvJyz0IVQ0RmuMTaQPbr6mtK5NEDaUg4/I+LHGnnOgxHcMMv11SWSKB6SvpAjHIodFO0GyZHRFY+4EE/f9CeS10bMR6yZJ9n9ewsBC4jA+7SEsRk1OXpiWLLJkGqhfmoIvf6GACwSP555wDZyLxjxpUpuyAeuCjvSvverfvx2fIO+Gp/9WSWf8Qs0Rf8PXQP2KAYwiI+TZVdq4TpWceIGaXahHwCeM0PGQIOEtp5eEVa8HhXYfvcTjWvzXMwAMBlM/BnzXUuZNQu4Wm7dcoEvWTrU5IUvr+XdgUzU1V43eK0p3MK1Irkr5vlcZvVcCmyrpLV/+Q6BSZZM8lOCCpTrNP1WXzG6C4rqFIJPOgkB+VdhldAjfoErdfqxVf9vjMY1LC775xXiivX1ZSjA3NusrNFYTfPP5tkueyAAAA=" width="106" height="47" class="img_ev3q"></p>
<p>change <code>chrome://flags/#enable-gpu-rasterization</code> from <code>Default</code> to <code>Disabled</code>.</p>
<p>(It&#x27;s actually happening very rarely for me, so I put back the setting to <code>Default</code>.)</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/chrome">chrome</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/til/2023/01/12/xclip and xsel">xclip and xsel</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-01-12T00:00:00.000Z">January 12, 2023</time></div></header><div class="markdown"><p><code>xclip</code> is a command line utility to get or set content in the X selection or clipboard.</p>
<p>It has a strange side effect when used to set things in the clipboard, it make the terminal to hang for a couple of seconds when closed, and more annoyingly it prevent Sublime Merge to terminate a command making use of it. This is probably linked to the fact that <code>xclip</code> starts a background process and leaves it running, as it is necessary for when the clipboard content is retrieved.</p>
<p>After tinkering with it, I wasn&#x27;t able make it work better. However I discovered <code>xsel</code>, which doesn&#x27;t the same things without this unwanted side effect.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/xclip">xclip</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/xsel">xsel</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/til/2022/12/19/inotify watches">inotify watches</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-12-19T00:00:00.000Z">December 19, 2022</time></div></header><div class="markdown"><div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>EDIT (2025)</div><div class="admonitionContent_BuS1"><p>I now use <a href="https://github.com/mikesart/inotify-info" target="_blank" rel="noopener noreferrer">github.com/mikesart/inotify-info</a> which is much faster.</p><p>Below is the original post, with the old method:</p></div></div>
<p>Check how many inotify watches are being used:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Get the procs sorted by the number of inotify watches</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># @author Carl-Erik Kopseng</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># @latest https://github.com/fatso83/dotfiles/blob/master/utils/scripts/inotify-consumers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Discussion leading up to answer: https://unix.stackexchange.com/questions/15509/whos-consuming-my-inotify-resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># If you need ultimate speed, use https://github.com/fatso83/dotfiles/commit/inotify-consumers-v1-fastest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># # Speed enhancements by Simon Matter &lt;simon.matter@invoca.ch&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># A later PR introduced a significant slowdown to gain better output, but it is insignificant on most machines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># See this for details: https://github.com/fatso83/dotfiles/pull/10#issuecomment-1122374716</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">%</span><span class="token string variable" style="color:#36acaa">${WLEN}</span><span class="token string" style="color:#e3116c">s  %</span><span class="token string variable" style="color:#36acaa">${WLEN}</span><span class="token string" style="color:#e3116c">s</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;INOTIFY&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;INSTANCES&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%</span><span class="token string variable" style="color:#36acaa">${WLEN}</span><span class="token string" style="color:#e3116c">s  %</span><span class="token string variable" style="color:#36acaa">${WLEN}</span><span class="token string" style="color:#e3116c">s</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;WATCHES&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PER   &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%</span><span class="token string variable" style="color:#36acaa">${WLEN}</span><span class="token string" style="color:#e3116c">s  %</span><span class="token string variable" style="color:#36acaa">${WLEN}</span><span class="token string" style="color:#e3116c">s  %s</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; COUNT &quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PROCESS &quot;</span><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;PID USER         COMMAND&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">printf</span><span class="token plain"> -- </span><span class="token string" style="color:#e3116c">&quot;------------------------------------------------------------</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    generateData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">usage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Usage: </span><span class="token string variable" style="color:#36acaa">$0</span><span class="token string" style="color:#e3116c"> [--help|--limits]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    -l, --limits    Will print the current related limits and how to change them</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    -h, --help      Show this help</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">FYI:  Check out Michael Sartain&#x27;s C++ take on this script. The native executable</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      is much faster, modern and feature rich. It can be found at</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      https://github.com/mikesart/inotify-info</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">limits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">Current limits</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">-------------</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sysctl</span><span class="token plain"> fs.inotify.max_user_instances fs.inotify.max_user_watches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Changing settings permanently</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">-----------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">sudo sysctl -p # re-read config</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">generateData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> PROC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> PID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> CNT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> INSTANCES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> TOT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> TOTINSTANCES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># read process list into cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PSLIST</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">ps</span><span class="token string variable" style="color:#36acaa"> ax </span><span class="token string variable parameter variable" style="color:#36acaa">-o</span><span class="token string variable" style="color:#36acaa"> pid,user</span><span class="token string variable operator" style="color:#393A34">=</span><span class="token string variable" style="color:#36acaa">WIDE-COLUMN,command $COLSTRING</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">INOTIFY</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">find</span><span class="token string variable" style="color:#36acaa"> /proc/</span><span class="token string variable punctuation" style="color:#393A34">[</span><span class="token string variable number" style="color:#36acaa">0</span><span class="token string variable" style="color:#36acaa">-9</span><span class="token string variable punctuation" style="color:#393A34">]</span><span class="token string variable" style="color:#36acaa">*/fdinfo </span><span class="token string variable parameter variable" style="color:#36acaa">-type</span><span class="token string variable" style="color:#36acaa"> f </span><span class="token string variable operator file-descriptor important" style="color:#393A34">2</span><span class="token string variable operator" style="color:#393A34">&gt;</span><span class="token string variable" style="color:#36acaa">/dev/null </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">xargs</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">grep</span><span class="token string variable" style="color:#36acaa"> ^inotify </span><span class="token string variable operator file-descriptor important" style="color:#393A34">2</span><span class="token string variable operator" style="color:#393A34">&gt;</span><span class="token string variable" style="color:#36acaa">/dev/null</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">INOTIFYCNT</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable builtin class-name" style="color:#36acaa">echo</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&quot;</span><span class="token string variable string variable" style="color:#36acaa">$INOTIFY</span><span class="token string variable string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">cut</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-d</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&quot;/&quot;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-s</span><span class="token string variable" style="color:#36acaa"> --output-delimiter</span><span class="token string variable operator" style="color:#393A34">=</span><span class="token string variable string" style="color:#e3116c">&quot; &quot;</span><span class="token string variable" style="color:#36acaa">  </span><span class="token string variable parameter variable" style="color:#36acaa">-f</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable number" style="color:#36acaa">3</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable function" style="color:#d73a49">uniq</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-c</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">sed</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-e</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&#x27;s/:.*//&#x27;</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># unique instances per process is denoted by number of inotify FDs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">INOTIFYINSTANCES</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable builtin class-name" style="color:#36acaa">echo</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&quot;</span><span class="token string variable string variable" style="color:#36acaa">$INOTIFY</span><span class="token string variable string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">cut</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-d</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&quot;/&quot;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-s</span><span class="token string variable" style="color:#36acaa"> --output-delimiter</span><span class="token string variable operator" style="color:#393A34">=</span><span class="token string variable string" style="color:#e3116c">&quot; &quot;</span><span class="token string variable" style="color:#36acaa">   </span><span class="token string variable parameter variable" style="color:#36acaa">-f</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable number" style="color:#36acaa">3,5</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">sed</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-e</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&#x27;s/:.*//&#x27;</span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">uniq</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable function" style="color:#d73a49">awk</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&#x27;{print $1}&#x27;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable function" style="color:#d73a49">uniq</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-c</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">INOTIFYUSERINSTANCES</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;$(echo &quot;</span><span class="token string variable" style="color:#36acaa">$INOTIFY</span><span class="token string" style="color:#e3116c">&quot; | cut -d &quot;/&quot; -s --output-delimiter=&quot; &quot;   -f 3,5 | sed -e &#x27;s/:.*//&#x27; | uniq |</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    	     while read PID FD; do echo </span><span class="token string variable" style="color:#36acaa">$PID</span><span class="token string" style="color:#e3116c"> </span><span class="token string variable" style="color:#36acaa">$FD</span><span class="token string" style="color:#e3116c"> </span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">grep</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-e</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&quot;^ *</span><span class="token string variable string variable" style="color:#36acaa">${PID}</span><span class="token string variable string" style="color:#e3116c"> &quot;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">&lt;&lt;&lt;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&quot;</span><span class="token string variable string variable" style="color:#36acaa">$PSLIST</span><span class="token string variable string" style="color:#e3116c">&quot;</span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable function" style="color:#d73a49">awk</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&#x27;{print $2}&#x27;</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">; done | cut -d&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;  -f 3 | sort | uniq -c |sort -nr)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$INOTIFYCNT</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token builtin class-name">read</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-rs</span><span class="token plain"> CNT PROC</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># count watches of processes found</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${PROC}</span><span class="token string" style="color:#e3116c">,</span><span class="token string variable" style="color:#36acaa">${CNT}</span><span class="token string" style="color:#e3116c">,</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable builtin class-name" style="color:#36acaa">echo</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&quot;</span><span class="token string variable string variable" style="color:#36acaa">$INOTIFYINSTANCES</span><span class="token string variable string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable function" style="color:#d73a49">grep</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&quot; </span><span class="token string variable string variable" style="color:#36acaa">${PROC}</span><span class="token string variable string" style="color:#e3116c">$&quot;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">|</span><span class="token string variable function" style="color:#d73a49">awk</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&#x27;{print $1}&#x27;</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;,0,&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic"># remove entires without watches</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">sort</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;,&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-k</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2,3</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic"># sort to begin with highest numbers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">                                </span><span class="token comment" style="color:#999988;font-style:italic"># group commands so that $TOT is visible in the printf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	    </span><span class="token assign-left variable environment constant" style="color:#36acaa">IFS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;,&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token builtin class-name">read</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-rs</span><span class="token plain"> PID CNT INSTANCES</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># show watches and corresponding process info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%</span><span class="token string variable" style="color:#36acaa">$((</span><span class="token string variable" style="color:#36acaa"> WLEN </span><span class="token string variable operator" style="color:#393A34">-</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable number" style="color:#36acaa">2</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable" style="color:#36acaa">))</span><span class="token string" style="color:#e3116c">d  %</span><span class="token string variable" style="color:#36acaa">$((</span><span class="token string variable" style="color:#36acaa"> WLEN </span><span class="token string variable operator" style="color:#393A34">-</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable number" style="color:#36acaa">2</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable" style="color:#36acaa">))</span><span class="token string" style="color:#e3116c">d     %s</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$CNT</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$INSTANCES</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable function" style="color:#d73a49">grep</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable parameter variable" style="color:#36acaa">-e</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&quot;^ *</span><span class="token string variable string variable" style="color:#36acaa">${PID}</span><span class="token string variable string" style="color:#e3116c"> &quot;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable operator" style="color:#393A34">&lt;&lt;&lt;</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable string" style="color:#e3116c">&quot;</span><span class="token string variable string variable" style="color:#36acaa">$PSLIST</span><span class="token string variable string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token assign-left variable" style="color:#36acaa">TOT</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$((</span><span class="token variable" style="color:#36acaa"> TOT </span><span class="token variable operator" style="color:#393A34">+</span><span class="token variable" style="color:#36acaa"> CNT </span><span class="token variable" style="color:#36acaa">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token assign-left variable" style="color:#36acaa">TOTINSTANCES</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$((</span><span class="token variable" style="color:#36acaa"> TOTINSTANCES </span><span class="token variable operator" style="color:#393A34">+</span><span class="token variable" style="color:#36acaa"> INSTANCES</span><span class="token variable" style="color:#36acaa">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	    </span><span class="token comment" style="color:#999988;font-style:italic"># These stats should be per-user as well, since inotify limits are per-user..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">%</span><span class="token string variable" style="color:#36acaa">$((</span><span class="token string variable" style="color:#36acaa"> WLEN </span><span class="token string variable operator" style="color:#393A34">-</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable number" style="color:#36acaa">2</span><span class="token string variable" style="color:#36acaa"> </span><span class="token string variable" style="color:#36acaa">))</span><span class="token string" style="color:#e3116c">d  %s</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$TOT</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;WATCHES TOTAL COUNT&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the total across different users is somewhat meaningless, not printing for now.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#            printf &quot;\n%$(( WLEN - 2 ))d  %s\n&quot; &quot;$TOTINSTANCES&quot; &quot;TOTAL INSTANCES COUNT&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;INotify instances per user (e.g. limits specified by fs.inotify.max_user_instances): &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;INSTANCES    USER&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-----------  ------------------&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$INOTIFYUSERINSTANCES</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">column</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># get terminal width</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">declare</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">COLS</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">tput cols </span><span class="token variable operator file-descriptor important" style="color:#393A34">2</span><span class="token variable operator" style="color:#393A34">&gt;</span><span class="token variable" style="color:#36acaa">/dev/null </span><span class="token variable operator" style="color:#393A34">||</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable builtin class-name" style="color:#36acaa">echo</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">80</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">declare</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">WLEN</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">declare</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">COLSTRING</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;--columns </span><span class="token string variable" style="color:#36acaa">$((</span><span class="token string variable" style="color:#36acaa"> COLS </span><span class="token string variable operator" style="color:#393A34">-</span><span class="token string variable" style="color:#36acaa"> WLEN </span><span class="token string variable" style="color:#36acaa">))</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># get terminal width</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;--limits&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-l&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    limits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;--help&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-h&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># added this line and moved some declarations to allow for the full display instead of a truncated version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;--full&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-o</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-f&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">unset</span><span class="token plain"> COLSTRING</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">Unknown parameter &#x27;</span><span class="token string variable" style="color:#36acaa">$1</span><span class="token string" style="color:#e3116c">&#x27;</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token file-descriptor important">&amp;2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main</span><br></span></code></pre></div></div>
<p><a href="https://github.com/fatso83/dotfiles/blob/master/utils/scripts/inotify-consumers" target="_blank" rel="noopener noreferrer">https://github.com/fatso83/dotfiles/blob/master/utils/scripts/inotify-consumers</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/inotify">inotify</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/file-system">file system</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/til/2022/12/19/rsync and file renames">rsync and file renames</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-12-19T00:00:00.000Z">December 19, 2022</time></div></header><div class="markdown"><p><code>rsync</code> doesn&#x27;t handle file/folder renames well: if a folder containing lots of big files (a photos/videos library) is renamed in the source, then the existing files in the destination will be deleted, and all files will be copied again to the destination.</p>
<p><a href="https://github.com/bcpierce00/unison" target="_blank" rel="noopener noreferrer">Unison</a> appears to handle file renames, but what it actually does is detecting that the files already exist in the destination, and making a copy of them in the destination, from the destination. This saves bandwidth, but is still slow and will stress hard drives for no reason.</p>
<p>A tool made by one single person addresses this issue perfectly: <a href="https://github.com/m-manu/rsync-sidekick" target="_blank" rel="noopener noreferrer"><code>rsync-sidekick</code></a></p>
<p>The author mentions that the tool doesn&#x27;t make any changes, but to make sure of it, we can run it in a Docker container with readonly volumes. It will output a list of commands to rename and move stuff in the destination to reproduce the renames/moves made in the source.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage<a href="#usage" class="hash-link" aria-label="Direct link to Usage" title="Direct link to Usage" translate="no">​</a></h3>
<ul>
<li>Build the container:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> rsync-sidekick </span><span class="token builtin class-name">.</span><br></span></code></pre></div></div>
<ul>
<li>Run it:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#36acaa">--rm</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">source-path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:/sync-src:ro </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">destination-path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:/sync-dst:ro </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rsync-sidekick </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	/bin/bash </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rsync-sidekick -shellscript /sync-src/ /sync-dst/ &amp;&amp; echo &amp;&amp; cat sync_actions_*.sh&quot;</span><br></span></code></pre></div></div>
<ul>
<li>
<p>Retrieve the output, check it visually, replace <code>sync-src</code> and <code>sync-dst</code>, and run it.</p>
</li>
<li>
<p>Run <code>rsync</code> on dry-run:</p>
</li>
</ul>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rsync</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-ruvin</span><span class="token plain"> /</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">source-path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/ /</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">destination-path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><br></span></code></pre></div></div>
<ul>
<li>Check the output; if all is ok, run <code>rsync</code>:</li>
</ul>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rsync</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-ruvi</span><span class="token plain"> /</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">source-path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/ /</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">destination-path</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="remote-directories">Remote directories<a href="#remote-directories" class="hash-link" aria-label="Direct link to Remote directories" title="Direct link to Remote directories" translate="no">​</a></h3>
<p><code>rsync-sidekick</code> only supports local directories at the moment, so to use it with a remote one, we need to mount the directory locally. Example with SSH:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> ~/remote-dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sshfs </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">server</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:/</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">path-on-server</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ~/remote-dir</span><br></span></code></pre></div></div>
<p>Then you can use <code>~/remote-dir</code> as a local directory.</p>
<p>To unmount it, run:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fusermount </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token plain"> ~/remote-dir</span><br></span></code></pre></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/rsync">rsync</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/til/2022/12/05/JSON stringify circular references">JSON stringify circular references</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-12-05T00:00:00.000Z">December 5, 2022</time></div></header><div class="markdown"><p>Not really a TIL, but more a knack: stringify an object containing circular references:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">safeStringify</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">obj</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> indent </span><span class="token parameter operator" style="color:#393A34">=</span><span class="token parameter"> </span><span class="token parameter number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> cache </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> retVal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		obj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">key</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;object&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">includes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Duplicate reference found, discard key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">					</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> value </span><span class="token comment" style="color:#999988;font-style:italic">// Store value in our collection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		indent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	cache </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> retVal</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Use like:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">safeStringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>From <a href="https://stackoverflow.com/questions/11616630/how-can-i-print-a-circular-structure-in-a-json-like-format" target="_blank" rel="noopener noreferrer">here</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/json">json</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/stringify">stringify</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/til/2022/11/23/wget for FTP">wget for FTP</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-11-23T00:00:00.000Z">November 23, 2022</time></div></header><div class="markdown"><p>Download the content of an FTP folder with <code>wget</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--user</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">username</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> --ask-password </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain"> ftp://</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">url</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>Although it took minutes to download 10 MB...</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/wget">wget</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/ftp">ftp</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/cli">cli</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/til/tags/command">command</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Zwyx.dev</div></div></div></footer></div>
</body>
</html>